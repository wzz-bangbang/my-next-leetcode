1. `postMessage`（最通用、跨域 iframe 必会）
适用：必须拿到对方 window 引用（open 的返回值、iframe.contentWindow、opener、parent 等）。
- 父页面 ↔ iframe
- A tab ↔ B tab（window.open 得到引用）
- **跨域**也可以（这是它最大价值）
核心机制
- `otherWindow.postMessage(message, targetOrigin)`
- 目标窗口 `window.addEventListener('message', handler)`
缺点/坑
- **安全**：必须校验 `event.origin` + `event.source`
- `targetOrigin` 不要乱写 `'*'`（除非你同时严格校验 origin）
- 复杂场景要做握手/心跳等

 2. `MessageChannel`（“高频双向专线”，常配合 postMessage）
适用
- **像“socket”的双向通信**
- 需要**把通道转交**给 iframe/worker（更干净的隔离）
- 消息量大、希望避免全局 message 事件混乱 
核心机制
- `const channel = new MessageChannel()`
- `channel.port1` / `channel.port2`
- 把 `port2` 通过 `postMessage` 传给对方（transferable）
优点
- 通信通道是“私有的”，不跟全局 message 混在一起
- 结构更清晰，适合封装 RPC
缺点/坑
- 仍然要靠 `postMessage` 去“交付端口”
- 需要管理 port 生命周期（关闭、重连）

3. `localStorage`（严格说它不是通信 API，但能“广播”）
这里指的是：**localStorage + storage 事件**。
当成“事件总线”用没问题，但只适合低频、幂等的状态同步，不适合高频实时消息。
适用
- **同源** 多 Tab 之间的低频同步    
- 简单事件通知：登录态变化、主题切换、登出
机制
- A tab `localStorage.setItem(key, value)`
- B tab 触发 `window.addEventListener('storage', ...)`
优点
- 非常简单
- 兼容好
缺点/坑（重要）
- **同一个 tab不会触发 storage 事件**（只在其他文档触发）
- 写入是同步的，频繁写会卡
- 容量小、只支持字符串
- 事件可能丢（你写得太快、只保留最后一次值）

4. URL 参数 + 监听 URL 变化（“可分享状态”）
这里其实分两类：`hash` 和 `history`。
适用
- 需要**可复制链接、可回放**的状态：筛选条件、分页、tab、搜索关键词
- iframe 里跟父页面共享“状态”也可以（但通常同源更方便）
监听方式
- `hashchange`：监听 `location.hash` 变化
- `popstate`：监听浏览器前进/后退引起的 history 变化
- 如果你用 `pushState/replaceState`，要么自己封装事件，要么依赖框架路由
优点
- 状态天然可分享、可刷新恢复
- SEO/可观测性更好（视情况）
缺点/坑
- 不是实时通信，只适合“状态同步”
- 参数暴露在 URL：别放敏感信息
- URL 长度限制（不要塞大 JSON）
- 跨域 iframe 控制父 URL 受限（同源策略）

4. `BroadcastChannel` **同源的发布-订阅广播通道。** （同源多 Tab 广播首选） 
同一个 origin 下：
- 多个 Tab
- 多个 iframe
- 同源 worker  
都能加入一个 channel，并互相广播消息。
特点
- API 比 localStorage 事件更像真正的消息系统
- 适合：实时通知、协同、状态广播
缺点：部分老环境兼容性略差（但现代浏览器基本 OK）

5. `SharedWorker`
- 多个 Tab 共享一个 worker 实例，天然“中枢”
- 适合：多 Tab 共享 websocket 连接、共享缓存/状态
- 缺点：兼容性、复杂度更高


总结：
1. **跨窗口/跨域 iframe 通信首选：`postMessage`**
    
2. **需要“高频双向、可建立专用通道”：`MessageChannel` + `postMessage` 传端口**
    
3. **同源多 Tab 广播：`BroadcastChannel`**
    
4. **同源多 Tab 低频同步：`localStorage` 的 `storage` 事件**
    
5. **需要把状态放进 URL（可分享/可回放）：URL 参数（或 hash）**
    
6. **需要更强的后台能力/离线：Service Worker / SharedWorker